
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Talk to Lina ðŸ¤–</title>
</head>
<body>
  <h2>Talk to Lina ðŸ¤–</h2>
  <button id="micBtn">ðŸŽ¤ Start Recording</button>
  <audio id="responseAudio" controls></audio>

  <script>
    const micBtn = document.getElementById("micBtn");
    const responseAudio = document.getElementById("responseAudio");

    let mediaRecorder;
    let audioChunks = [];
    let isRecording = false;

    micBtn.onclick = async () => {
      if (!isRecording) {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];

        mediaRecorder.ondataavailable = event => {
          audioChunks.push(event.data);
        };

        mediaRecorder.onstop = async () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
          const formData = new FormData();
          formData.append("file", audioBlob, "recording.webm");

          const res = await fetch("/process-audio", {
            method: "POST",
            body: formData
          });

          const audioURL = await res.text();
          responseAudio.src = audioURL;
          responseAudio.play();
        };

        mediaRecorder.start();
        micBtn.innerText = "ðŸ›‘ Stop Recording";
        isRecording = true;
      } else {
        mediaRecorder.stop();
        micBtn.innerText = "ðŸŽ¤ Start Recording";
        isRecording = false;
      }
    };
  </script>
</body>
</html>
